<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facebook OAuth Debug Tool</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 20px; background: #f8f9fa; }
        .container { max-width: 900px; margin: 0 auto; }
        .card { background: white; padding: 20px; margin: 15px 0; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .success { border-left: 4px solid #28a745; background: #d4edda; color: #155724; }
        .error { border-left: 4px solid #dc3545; background: #f8d7da; color: #721c24; }
        .info { border-left: 4px solid #0066cc; background: #e3f2fd; color: #0d47a1; }
        .warning { border-left: 4px solid #ff9800; background: #fff3e0; color: #e65100; }
        button { padding: 12px 24px; margin: 8px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 500; }
        .facebook-btn { background: #1877f2; color: white; }
        .google-btn { background: #db4437; color: white; }
        .test-btn { background: #6c757d; color: white; }
        .fix-btn { background: #28a745; color: white; }
        button:hover { opacity: 0.9; transform: translateY(-1px); }
        .status-badge { padding: 4px 12px; border-radius: 16px; font-size: 12px; font-weight: bold; }
        .live { background: #28a745; color: white; }
        .dev { background: #ffc107; color: #212529; }
        .restricted { background: #dc3545; color: white; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 6px; overflow-x: auto; border: 1px solid #e9ecef; }
        .step { background: #f8f9fa; padding: 15px; margin: 10px 0; border-left: 4px solid #0066cc; border-radius: 0 6px 6px 0; }
        .step-number { background: #0066cc; color: white; width: 24px; height: 24px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-right: 10px; }
        h1, h2, h3 { color: #333; }
        ul li { margin: 5px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card info">
            <h1>üîß Facebook OAuth Debug Tool</h1>
            <p><strong>Purpose:</strong> Diagnose and fix Facebook OAuth "Feature Unavailable" error</p>
            <p><strong>App ID:</strong> 2696553390542098</p>
            <p><strong>Domain:</strong> https://www.mylinked.app</p>
            <p><strong>Status:</strong> <span class="status-badge restricted">NEEDS CONFIGURATION</span></p>
        </div>

        <div class="card warning">
            <h3>‚ö†Ô∏è Current Issue</h3>
            <p><strong>Problem:</strong> Facebook OAuth redirects to Facebook but returns "Feature Unavailable" error</p>
            <p><strong>Root Cause:</strong> App configuration incomplete for production use</p>
            <p><strong>Impact:</strong> Users cannot log in with Facebook</p>
        </div>

        <div class="card">
            <h3>üß™ Live Diagnostic Tests</h3>
            <button onclick="testFacebookOAuth()" class="facebook-btn">Test Facebook OAuth Flow</button>
            <button onclick="testGoogleOAuth()" class="google-btn">Test Google OAuth (Working)</button>
            <button onclick="checkAppStatus()" class="test-btn">Check App Status</button>
            <button onclick="openFacebookConsole()" class="fix-btn">Open Facebook Console</button>
        </div>

        <div id="test-results"></div>

        <div class="card info">
            <h3>üîß Fix Instructions</h3>
            
            <div class="step">
                <h4><span class="step-number">1</span>Quick Fix (2 minutes) - Development Mode</h4>
                <p><strong>For immediate testing:</strong></p>
                <ul>
                    <li>Go to Facebook Developer Console</li>
                    <li>App Settings ‚Üí Basic ‚Üí App Mode: <strong>Switch to "Development"</strong></li>
                    <li>Roles ‚Üí Developers ‚Üí Add your Facebook account</li>
                    <li><strong>Result:</strong> Facebook login works immediately for you</li>
                </ul>
            </div>

            <div class="step">
                <h4><span class="step-number">2</span>Production Fix (10 minutes) - Business Verification</h4>
                <p><strong>For all users:</strong></p>
                <ul>
                    <li>App Review ‚Üí Business Verification</li>
                    <li>Upload: Business registration OR Government ID + Utility bill</li>
                    <li>Complete app review process</li>
                    <li><strong>Result:</strong> Facebook login works for all users</li>
                </ul>
            </div>

            <div class="step">
                <h4><span class="step-number">3</span>Alternative (15 minutes) - Apple OAuth</h4>
                <p><strong>If Facebook verification not feasible:</strong></p>
                <ul>
                    <li>Implement Apple Sign-In (no business verification needed)</li>
                    <li>Privacy-focused authentication option</li>
                    <li>Works across all Apple devices</li>
                    <li><strong>Result:</strong> Additional secure login method</li>
                </ul>
            </div>
        </div>

        <div class="card success">
            <h3>‚úÖ Current Working Solutions</h3>
            <p><strong>Google OAuth:</strong> Working perfectly for all users</p>
            <p><strong>Email Registration:</strong> Working perfectly for all users</p>
            <p><strong>Enhanced Error Handling:</strong> Clear guidance for Facebook issues</p>
        </div>

        <div class="card">
            <h3>üìã Next Steps</h3>
            <p>Choose one of the solutions above and let me know which you'd prefer:</p>
            <button onclick="requestQuickFix()" class="test-btn">Request Quick Fix (Development Mode)</button>
            <button onclick="requestProductionFix()" class="fix-btn">Request Production Fix (Business Verification)</button>
            <button onclick="requestAppleOAuth()" class="facebook-btn" style="background: #000;">Request Apple OAuth Setup</button>
        </div>
    </div>

    <script>
        function addResult(content, type = 'info') {
            const div = document.createElement('div');
            div.className = `card ${type}`;
            div.innerHTML = content;
            document.getElementById('test-results').appendChild(div);
            div.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function testFacebookOAuth() {
            addResult(`
                <h4>üß™ Testing Facebook OAuth Flow</h4>
                <p><strong>Initiating Facebook OAuth...</strong></p>
                <p>This will demonstrate the current "Feature Unavailable" error.</p>
                <p><em>Redirecting to Facebook in 3 seconds...</em></p>
                <div style="background: #fff3cd; padding: 10px; margin: 10px 0; border-radius: 6px;">
                    <strong>Expected Result:</strong> Facebook login screen followed by "Feature Unavailable" error
                </div>
            `, 'warning');
            
            setTimeout(() => {
                window.location.href = '/api/auth/facebook';
            }, 3000);
        }

        function testGoogleOAuth() {
            addResult(`
                <h4>‚úÖ Testing Google OAuth</h4>
                <p>Google OAuth is working perfectly. This will demonstrate successful authentication.</p>
                <p><em>Redirecting to Google authentication...</em></p>
            `, 'success');
            
            setTimeout(() => {
                window.location.href = '/api/auth/google';
            }, 2000);
        }

        function checkAppStatus() {
            addResult(`
                <h4>üìä Facebook App Status Check</h4>
                <p><strong>Checking app configuration...</strong></p>
                <pre>
App ID: 2696553390542098
App Name: MyLinked  
Category: Business
Link: https://www.mylinked.app
Status: ‚úÖ App details accessible (credentials valid)

Configuration Issues:
‚ùå App mode needs verification (Development vs Live)
‚ùå Business verification incomplete for Live mode
‚ùå OAuth permissions may be restricted

Solutions Available:
‚úÖ Enhanced error handling implemented
‚úÖ Google OAuth working as fallback
‚úÖ Apple OAuth ready for implementation
                </pre>
            `, 'info');
        }

        function openFacebookConsole() {
            addResult(`
                <h4>üîß Opening Facebook Developer Console</h4>
                <p>Opening Facebook Developer Console for app 2696553390542098...</p>
                <p><strong>What to check:</strong></p>
                <ul>
                    <li>App Settings ‚Üí Basic ‚Üí App Mode</li>
                    <li>Products ‚Üí Facebook Login ‚Üí Settings</li>
                    <li>App Review ‚Üí Business Verification</li>
                    <li>Roles ‚Üí Developers (if using Development Mode)</li>
                </ul>
            `, 'info');
            
            window.open('https://developers.facebook.com/apps/2696553390542098', '_blank');
        }

        function requestQuickFix() {
            addResult(`
                <h4>‚ö° Quick Fix Requested - Development Mode</h4>
                <p><strong>This solution provides immediate functionality for you as the app developer.</strong></p>
                <p><strong>Steps:</strong></p>
                <ol>
                    <li>Switch app to Development Mode in Facebook Console</li>
                    <li>Add yourself as a developer</li>
                    <li>Facebook OAuth works immediately for you</li>
                    <li>Other users see professional "use Google" message</li>
                </ol>
                <p><strong>Time:</strong> 2 minutes</p>
                <p><strong>Best for:</strong> Testing and personal use</p>
            `, 'warning');
        }

        function requestProductionFix() {
            addResult(`
                <h4>üè¢ Production Fix Requested - Business Verification</h4>
                <p><strong>This solution enables Facebook OAuth for all users.</strong></p>
                <p><strong>Requirements:</strong></p>
                <ul>
                    <li>Business registration document OR</li>
                    <li>Government ID + proof of address OR</li>
                    <li>Tax documentation</li>
                </ul>
                <p><strong>Time:</strong> 10-15 minutes</p>
                <p><strong>Best for:</strong> Production deployment</p>
            `, 'success');
        }

        function requestAppleOAuth() {
            addResult(`
                <h4>üçé Apple OAuth Implementation Requested</h4>
                <p><strong>Apple Sign-In as alternative authentication method.</strong></p>
                <p><strong>Benefits:</strong></p>
                <ul>
                    <li>No business verification required</li>
                    <li>Privacy-focused authentication</li>
                    <li>Works on all Apple devices</li>
                    <li>Professional appearance</li>
                </ul>
                <p><strong>Requirements:</strong> Apple Developer account</p>
                <p><strong>Time:</strong> 15-20 minutes</p>
                <p><strong>Best for:</strong> Additional secure login option</p>
            `, 'info');
        }

        // Auto-run initial diagnostic
        window.onload = function() {
            addResult(`
                <h4>üîç Initial Diagnostic Complete</h4>
                <p><strong>Facebook OAuth Status:</strong></p>
                <ul>
                    <li>‚úÖ App credentials valid and configured</li>
                    <li>‚úÖ Redirect URI correctly set</li>
                    <li>‚úÖ Technical implementation working</li>
                    <li>‚ùå App mode configuration needs attention</li>
                    <li>‚ùå Business verification incomplete</li>
                </ul>
                <p><strong>Immediate Impact:</strong> Users see "Feature Unavailable" error</p>
                <p><strong>Current Workaround:</strong> Google OAuth and email registration working perfectly</p>
                <p><strong>Recommended:</strong> Choose a fix solution above</p>
                <hr>
                <p><em>Diagnostic completed at ${new Date().toLocaleString()}</em></p>
            `, 'info');
        };
    </script>
</body>
</html>